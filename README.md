# Проектная работа "Веб-ларек" 
 
Стек: HTML, SCSS, TS, Vite 
 
Структура проекта: 
- src/ — исходные файлы проекта 
- src/components/ — папка с JS компонентами 
- src/components/base/ — папка с базовым кодом 
 
Важные файлы: 
- index.html — HTML-файл главной страницы 
- src/types/index.ts — файл с типами 
- src/main.ts — точка входа приложения 
- src/scss/styles.scss — корневой файл стилей 
- src/utils/constants.ts — файл с константами 
- src/utils/utils.ts — файл с утилитами 
 
## Установка и запуск 
Для установки и запуска проекта необходимо выполнить команды 
 
``` 
npm install 
npm run start 
``` 
 
или 
 
``` 
yarn 
yarn start 
``` 
## Сборка 
 
``` 
npm run build 
``` 
 
или 
 
``` 
yarn build 
``` 
# Интернет-магазин «Web-Larёk» 
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер. 
 
## Архитектура приложения 
 
Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность: 
 
Model - слой данных, отвечает за хранение и изменение данных.   
View - слой представления, отвечает за отображение данных на странице.   
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных. 
 
Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений. 
 
### Базовый код 
 
#### Класс Component 
Является базовым классом для всех компонентов интерфейса. 
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения. 
 
Конструктор:   
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает. 
 
Поля класса:   
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента. 
 
Методы класса:   
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.   
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>` 
 
 
#### Класс Api 
Содержит в себе базовую логику отправки запросов. 
 
Конструктор:   
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов. 
 
Поля класса:   
`baseUrl: string` - базовый адрес сервера   
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов. 
 
Методы:   
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер   
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.   
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных. 
 
#### Класс EventEmitter 
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления. 
 
Конструктор класса не принимает параметров. 
 
Поля класса:   
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события. 
 
Методы класса:   
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.   
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.   
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра. 
 
##### Данные 
В ходе анализа полученных данных и в соответсвии ТЗ было принято решение о внедреннии двух интерфейсов  
1. Iproduct Интерфейс описывает структуру данных товара, которые приходят с сервера и используются в приложении для отображения карточек товаров, их детальной информации и работы корзины., в нём будут храниться следующие данные: id (по которому будут определяться что это за товар), title (название), image (изображение товара), category (категория товара), price (цена), description (описание товара). Форматы: id - string; title - string; image - string; category - string; price - number|null; description - string; 
2. IBuyer Интерфейс описывает структуру данных покупателя, которые приходят с сервера и используются в приложении при оформлении заказа, в нём будут храниться следующие данные: payment (способ оплаты), email (электронная почта), phone (номер телефона), address(адресс). Форматы: payment: - TPayment(cash|card); email - string; phone - string; address - string; 
3. IProductListResponse описывает ответ сервера при получении каталога: объект с единственным полем items:IProduct[];
4. IOrderRequest описывает полезную нагрузку при создании заказа: payment, address, email, phone, сумму заказа total:number и массив идентификаторов товаров items:string[];
5. IOrderResponse описывает ответ сервера на отправку заказа: id (идентификатор созданного заказа) и total (сумма списания);
 
###### Модели данных 
Класс Folder, хранит массив товаров, доступных для покупки и работы с выбранными товарами. 
Поля: items:IProduct[]-массив всех товаров, selectedItem: IProduct - товар, выбранный для дальнейшего действия.  
Методы: setItems(items: IProduct[]): void - сохранение массива товаров полученного в параметрах метода; getItems(): IProduct[] - получение массива товаров из модели; getItemById(id: string): IProduct  - получение одного товара по его id; setSelectedItem(item: IProduct): void - сохранение товара для подробного отображения; getSelectedItem(): IProduct | null - получение товара для подробного отображения. 
 
Класс Cart, хранит массив товаров, выбранных покупателем для покупки. 
Поля: items:IProduct[] - массив товаров, добавленных в корзину.  
Методы: getItems(): IProduct[] - получение массива товаров, которые находятся в корзине; addItem(item: IProduct): void - добавление товара, который был получен в параметре, в массив корзины; 
removeItem(item: IProduct): void - удаление товара, полученного в параметре из массива корзины; 
clear(): void - очистка корзины; 
getTotalPrice(): number - получение стоимости всех товаров в корзине; 
getCount():number - получение количества товаров в корзине; 
hasItem(id: string): boolean - проверка наличия товара в корзине по его id, полученного в параметр метода. 
 
Класс Buyer, хранит данные покупателя, которые используются при покупке + валидация. 
Поля: TPayment(cash|card); email - string; phone - string; address - string; 
Методы: setData(data: Partial<IBuyer>): void - сохраняет данные покупателя (есть возможность сохранить только один вариант телефон/почту); getData(): IBuyer - получение всех данных покупателя; 
clear(): void - очищение данных покупателя; validate(): Record<string, string> - валидация данных; 
 
###### Слой коммункации  
Вводится класс ApiServer. Данный класс будет представителем коммуникационного слоя, он будет отвечать за получение данных с сервера и отправку данных на сервер. Класс использует композицию, чтобы выполнить запросы на сервер через экземпляр Api и возвращает строго типизированные ответы.
Поля: api:Api - string; 
Методы: getProducts():IProductListResponse - GET-запрос возвращает объект с массивом товаров; sendOrder(order: IOrderRequest): IOrderResponse - POST-запрос отправляет сведения о заказе и возвращает идентификатор и сумму заказа;

###### Слой представления (View)
Слой View отвечает за отображение данных и реакцию на действия пользователя. Каждый класс представления управляет отдельным блоком интерфейса - карточками товаров, формами, модальными окнами и прочими элементами пользовательского взаимодействия.
В основе всех визуальных компонентов лежит базовый класс Component, который обеспечивает общие методы работы с DOM и отображения данных. Все классы представления наследуются от Component или реализуют композицию с ним.

Класс Form
Form - базовый родительский класс для всех форм сайта. Отвечает за общую логику работы с элементами формы: обработку полей, валидацию и генерацию событий при изменении данных или отправке формы.
Поля: formElement: HTMLFormElement - корневой элемент формы; fields: Record<string, HTMLInputElement> - коллекция полей ввода; events: EventEmitter - экземпляр брокера событий для генерации пользовательских действий.
Методы:
setFieldValue(name: string, value: string): void - установка значения поля по имени; getFieldValue(name: string): string - получение текущего значения поля; clear(): void - очистка всех полей формы; render(data?: object): HTMLElement - отображает форму и обновляет значения полей; onSubmit(event: Event): void - базовый обработчик отправки формы, вызывающий событие form:submit.
События:form:change - изменение значения в поле; form:submit - отправка формы пользователем;

Класс OrderForm (дочерний класс Form)
OrderForm - форма оформления заказа, наследует общий функционал от Form. Отвечает за ввод данных покупателя: способ оплаты, адрес, email и телефон.
Дополнительные методы: validate(): Record<string, string> - проверяет корректность данных;setPayment(method: string): void - установка способа оплаты.
События:
order:submit - пользователь подтвердил оформление заказа.

Класс ContactsForm (дочерний класс Form)
ContactsForm - форма для ввода контактных данных, используется при подтверждении заказа.
Дополнительные методы: fillFromBuyer(buyerData: IBuyer): void - заполняет поля на основе данных модели покупателя.
События: contacts:submit - пользователь завершил ввод контактных данных.

Класс Modal
Modal - универсальный класс для отображения модальных окон. Не имеет дочерних классов, так как любая разметка внутри модального окна представляет собой отдельный компонент, который может быть отображён как в модальном окне, так и в другом блоке страницы.
Поля:modalContainer: HTMLElement - контейнер модального окна; content: HTMLElement - элемент, в который помещается отображаемый компонент; events: EventEmitter - брокер событий.
Методы:open(content: HTMLElement): void - открывает модальное окно с переданным контентом; close(): void - закрывает модальное окно; handleOutsideClick(event: MouseEvent): void - закрытие модального окна при клике вне области контента.
События: modal:open - окно открыто; modal:close - окно закрыто пользователем.

Класс Card (родительский класс карточек товара)
Card - базовый класс для всех карточек товара. Содержит общий функционал: отображение данных товара, обработка кликов, установка изображения и цены.
Поля:container: HTMLElement - корневой элемент карточки; title: HTMLElement - название товара; price: HTMLElement - элемент цены; image: HTMLImageElement - изображение товара; button: HTMLButtonElement - кнопка действия (например, «Добавить в корзину»); events: EventEmitter - брокер событий.
Методы: render(data: IProduct): HTMLElement - отображение карточки по данным товара; setTitle(title: string): void - установка заголовка; setPrice(price: number | null): void - отображение цены или статуса «Нет в наличии»; setImage(src: string, alt?: string): void - установка изображения; handleClick(event: MouseEvent): void - базовый обработчик кликов по карточке.
События:  card:select - пользователь открыл детальную информацию о товаре; card:add - пользователь добавил товар в корзину.
Класс CatalogCard (дочерний класс Card)
CatalogCard - карточка товара, отображаемая в каталоге. Реализует поведение выбора товара и добавления в корзину.
Дополнительные методы: bindAddToCart(): void - обработка нажатия кнопки «Купить».
События: catalog:add - товар добавлен из каталога в корзину.

Класс BasketCard (дочерний класс Card)
BasketCard - карточка товара в корзине. Отображает сокращённую информацию и предоставляет кнопку удаления.
Дополнительные методы: bindRemove(): void - обработка нажатия кнопки удаления.
События: basket:remove - пользователь удалил товар из корзины.

Класс PreviewCard (дочерний класс Card)
PreviewCard - карточка для отображения детальной информации о товаре в модальном окне.
Дополнительные методы: setDescription(text: string): void - вывод подробного описания; bindBuy(): void - обработка нажатия кнопки покупки;
События:preview:buy - пользователь инициировал покупку из карточки предпросмотра.

Класс Header
Header - отвечает за отображение и взаимодействие с шапкой сайта.
Поля: logo: HTMLElement - элемент логотипа, по клику на который пользователь может вернуться на главную страницу; cartButton: HTMLElement - кнопка открытия корзины; cartCount: HTMLElement - элемент, отображающий количество товаров в корзине; events: EventEmitter - экземпляр брокера событий, используемый для передачи действий пользователя презентеру.
Методы: updateCartCount(count: number): void - обновляет количество товаров, отображаемое на иконке корзины. Если товаров нет, счётчик скрывается; setActive(state: boolean): void - визуально меняет состояние кнопки корзины (например, активное/неактивное состояние); registerEvents(): void - назначает обработчики событий: при клике на логотип генерируется событие 'logo:click', при клике на кнопку корзины - 'cart:open'.

#### Презентер
Презентер реализован в main.ts. Он использует модели, view и остальные ts файлы, после чего использует события.
Использует view для каталога, корзины, карточек.
Реагирует на различные события (event) изменяя состояния моедлей (например, наполнение корзины и выбор товаров)
Загружает каталог при старте, преслудет последовательность оформления заказов (Способ, адресс => Почта, телефон => успех) 
Управляет видемостью модального окна
